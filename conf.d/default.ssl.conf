server {
   listen      443 ssl spdy default;
   server_name _;
   root        /var/www/vhosts/default;
   index       index.php index.html index.htm;
   charset     utf-8;

   ssl                       on;
   ssl_certificate           /etc/nginx/ssl/default.pem;
   ssl_certificate_key       /etc/nginx/ssl/default.key;
   ssl_protocols             TLSv1 TLSv1.1 TLSv1.2;
   ssl_ciphers               'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:ECDHE-RSA-RC4-SHA:ECDHE-ECDSA-RC4-SHA:AES128:AES256:RC4-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!3DES:!MD5:!PSK';
   ssl_prefer_server_ciphers on;
   ssl_dhparam               /etc/nginx/ssl/default_dhparam.pem;
   ssl_session_tickets       on;
   ssl_session_ticket_key    /etc/nginx/ssl/default_ticket.key;
   ssl_session_cache         shared:SSL:10m;
   ssl_session_timeout       10m;
   ssl_stapling              on;
   ssl_stapling_verify       on;
   ssl_trusted_certificate   /etc/nginx/ssl/default_trusted.pem;

   # resolver 8.8.8.8 8.8.4.4 valid=300s;
   # resolver_timeout 5s;

   fastcgi_param HTTPS on;

   access_log  /var/log/nginx/default.ssl.access.log  main;
   error_log   /var/log/nginx/default.ssl.error.log;

  # include     /etc/nginx/drop;
  include     /etc/nginx/wp-w3tc;

   rewrite /wp-admin$ $scheme://$host$uri/ permanent;
   #rewrite ^(.*)(index|home|default)\.html? $1 permanent;

   set $mobile '';
   #include /etc/nginx/mobile-detect;

   set $do_not_cache 0;
   if ($http_cookie ~* "comment_author_|wordpress_(?!test_cookie)|wp-postpass_" ) {
       set $do_not_cache 1;
   }
   if ($request_method = POST) {
      set $do_not_cache 1;
   }

   #location ~* \.(js|css|html?|xml|gz|jpe?g|gif|png|swf|wmv|flv|ico)$ {
   #    index   index.html index.htm;
   #    include /etc/nginx/expires;
   #}

   location / {
       if ($request_filename ~ .*\.php) {
           break;
           proxy_pass http://backend;
       }
       include /etc/nginx/expires;

       pagespeed off;

       proxy_no_cache     $do_not_cache;
       proxy_cache_bypass $do_not_cache;

       proxy_redirect                     off;
       proxy_cache                        czone;
       proxy_cache_key                    "$scheme://$host$request_uri$mobile";
       proxy_cache_valid                  200 0m;
       proxy_set_header Host              $host;
       proxy_set_header X-Forwarded-Proto https;
       proxy_pass                         http://backend;
   }

   location ~* /(wp-login|wp-admin) {
       pagespeed off;
   }

   #include     /etc/nginx/phpmyadmin;
   location ~* /(phpmyadmin|myadmin|pma) {
       access_log off;
       log_not_found off;
       return 404;
   }

   # redirect server error pages to the static page /50x.html
   #
   error_page   500 502 503 504  /50x.html;
   location = /50x.html {
       root   /usr/share/nginx/html;
   }
}
